---
title: "My Data Visualisation Project"
author: "Seline Uran"
output: html_document
---
```{r = diagram1, echo=FALSE, message=FALSE}
#To begin load the following libraries
library(ggplot2)
library(readxl)
library(RColorBrewer)
library(scales)
library(dplyr)
library(tidyr)
library(tidyverse)
library(gridExtra)
```

<span style="text-decoration:underline">Research Questions</span>

These graphs present government survey data on the number of rough sleepers in England to consider the question; 

       1) Has homelessness increased over the past decade? 

       2) Is homelessness observed equally across all regions of England? 

<span style="text-decoration:underline">Data Origins</span>

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

<span style="text-decoration:underline">Data Preparation</span>

After having removed all sheets from the excel document except for the sheet that contained the total number of rough sleepers I began data preparation. 

```{r}
#importing the raw data
rawdata <- read_excel("~/myfinalproject/processed/rs_statistics.xlsx")
```

The raw data detailed the number of rough sleepers within England and individual counts for each region of England and each Local Authority within each region. 

My aim was to visualise the number of rough sleepers in each region of England across the last 10 years. I selected these rows from the data set. Since I aimed to visualize the number of rough sleepers in each region individually I removed the rows containing summary counts for 'England', 'London' and the 'Rest of England'. Then, I removed data associated with each Local Authority, columns containing the ONS code of each Region and Local Authority. 

```{r}
#slice the data to select the rows required
rs1<- rawdata %>% slice(1:11)

#columns and rows removed from the data
rs1<- rs1[-c(1:3), ]

#further rows removed from the data
rs1$`Local authority ONS code`<-NULL
rs1$`Local authority`<-NULL
rs1$`Region ONS code`<- NULL
```

Finally, I converted the data it into a 'long' format for use with ggplot2.

```{r}
#convert to a 'long' data set
rs1_long <- rs1 %>% 
  gather(Year, Number, -Region)
```

The tibble below shows a short section of the data. 

```{r}
#shows the first 16 rows of the dataframe
head(rs1_long, 16)
```

I then performed the same steps to prepare the data for the second visualisation; a pie chart of the number of rough sleepers in each region proportional to population, in 2019. 

```{r, message=FALSE}
#import the dataset relating to number of rough sleepers
rawdata <- read_excel("~/myfinalproject/processed/rs_statistics.xlsx")
#import the dataset relating to the population of eeach region
rawdata2<-read_excel("~/myfinalproject/processed/population.xlsx") 

#select columns of interest
rs2<- rawdata %>% slice(1:11)
#and then the rows of interest
rs2<- rs2[-c(1:3), ]
#remove the unwanted rows
rs2$`Local authority ONS code`<-NULL
rs2$`Local authority`<-NULL
rs2$`Region ONS code`<- NULL
rs2$`2010`<-NULL
rs2$`2011`<-NULL
rs2$`2012`<- NULL
rs2$`2013`<-NULL
rs2$`2014`<-NULL
rs2$`2015`<- NULL
rs2$`2016`<-NULL
rs2$`2017`<-NULL
rs2$`2018`<- NULL
rs2$`2020`<-NULL

#convert to a 'long' format
rs2_long <- rs2 %>% 
  gather(Year, Number, -Region)

#for the other data set...
#the rows and columns of interest are selected
rs3<- rawdata2 %>% slice(9, 23, 67, 92, 138, 173, 258, 329)
rs3<- rs3 %>% select(2, 5)

#colums are renamed appropriately
rs3<- rs3 %>% 
  rename(
    Region = ...2,
   "2019" = ...5)
#convert the data to 'long' format
rs3_long <- rs3 %>% 
  gather(Year, Number, -Region)
#the Number column is converted to a numeric variable
rs3_long$Number <- as.numeric(as.character(rs3_long$Number))

#dataset is reordered to match the other data set
rs3_long<- rs3_long %>% arrange(Region)

#column of interest is then selected
rs3_long<- rs3_long %>% select(3)

#the column is renamed to an appropriate name
rs3_long<- rs3_long %>%
    rename(Population = Number)

#the two datasets are combined
newtable<- cbind(rs2_long, rs3_long)
newtable <- transform(newtable, #to allow for a proportional percentage to be calculated
                      Percentage = Number / Population) 

#select the columns to be used for the piechart visualisation and assign to a new variable
newtable <- newtable %>% select(1,2,5)

head(newtable)
```

<span style="text-decoration:underline">Data Visualisation</span> 

Graph 1: Number of Rough Sleepers in England by Region (2010 - 2020)

```{r = graph1, message=FALSE, results='hide'}
#generates a line graph with several additional features
rs1plot <-ggplot(rs1_long, aes(x = Year, y = Number, color = Region, group = Region)) +
  geom_point() +
  geom_line(position = position_dodge(0.4)) + #clustered data points are distributed
  scale_color_brewer(palette = 'Dark2') + #a colour scheme is added
  theme(axis.text.x = element_text(face= "bold", color="black", 
                                 size=7),
        axis.text.y = element_text(face= "bold", color="black", 
                                  size=7),
        axis.line = element_line(colour = "black", 
                    size = 1, linetype = "solid")) + #aesthetic of the x/y axis
  labs(title="Number of Rough Sleepers in England by Region (2010 - 2020)",
       x="Year", y = "Number of Rough Sleepers") + #labels the x/y axis and title for plot
  scale_y_continuous(breaks=c(0, 300, 600, 900, 1200), limits=c(0, 1200)) #adjust the scale

ggsave("figures/rs1plot.png") #saves the graph as an image in figs folder
```

```{r echo=FALSE, warning=FALSE}
rs1plot #generates the plot
```


Graph 2: Number of Rough Sleepers by Region proportional to population (2019) 

``` {r = second visualisation, message=FALSE, results='hide'}
#look at the data prepared previously
view(newtable)

#generate a dataframe of the data
rspie<- data.frame(newtable)

#simple barplot is generated of the dataframe first
bp<- ggplot(rspie, aes(x="", y=Percentage, fill=Region))+
  geom_bar(width = 1, stat = "identity") + 
  geom_text(aes(label = paste(round(Percentage / sum(Percentage) * 100, 1), "%"), x = 1.7),
         position = position_stack(vjust = 0.5)) +
  ggtitle("help") +
  theme(axis.text = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid  = element_blank(),
        legend.position="none",
        line = element_blank()) + #blank template theme is added
  scale_fill_brewer(palette="Dark2") #colour scheme is added matching plot above


#barplot is converted into a piechart
rspiechart <- bp + coord_polar(theta = "y", start=0) +
  theme_void() +
  ggtitle("Rough sleepers as a proportion of region
          population (2019)")

#saves the graph as an image in figs folder
ggsave("figures/rspiechart.png")


#generates the pie chart
rspiechart
```


<span style="text-decoration:underline">Conclusion</span>

The main visualisation show that the number of rough sleepers in England appears to have increased within all regions in England from 2010 to 2020. The pie charts seem to indicate that there is the largest proportion of rough sleepers in England within the South East, South West and the East of England when calculating the numer of rough sleepers proportional to population size in that region. 
